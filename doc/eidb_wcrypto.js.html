<!DOCTYPE html><html lang="en" style="font-size:16px"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><script src="jsdoc-custom.js"></script><link type="text/css" rel="stylesheet" href="jsdoc-custom.css"><title>eidb/wcrypto.js</title><!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><script src="scripts/third-party/hljs.js" defer="defer"></script><script src="scripts/third-party/hljs-line-num.js" defer="defer"></script><script src="scripts/third-party/popper.js" defer="defer"></script><script src="scripts/third-party/tippy.js" defer="defer"></script><script src="scripts/third-party/tocbot.min.js"></script><script>var baseURL="/",locationPathname="",baseURL=(locationPathname=document.location.pathname).substr(0,locationPathname.lastIndexOf("/")+1)</script><link rel="stylesheet" href="styles/clean-jsdoc-theme.min.css"><svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none"><defs><symbol id="copy-icon" viewbox="0 0 488.3 488.3"><g><path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/><path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/></g></symbol><symbol id="search-icon" viewBox="0 0 512 512"><g><g><path d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z"/></g></g><g><g><path d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z"/></g></g></symbol><symbol id="font-size-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></symbol><symbol id="add-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></symbol><symbol id="minus-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M5 11h14v2H5z"/></symbol><symbol id="dark-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></symbol><symbol id="light-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></symbol><symbol id="reset-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772l.997 1.795z"/></symbol><symbol id="down-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path></symbol><symbol id="codepen-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.5 13.202L13 15.535v3.596L19.197 15 16.5 13.202zM14.697 12L12 10.202 9.303 12 12 13.798 14.697 12zM20 10.869L18.303 12 20 13.131V10.87zM19.197 9L13 4.869v3.596l3.5 2.333L19.197 9zM7.5 10.798L11 8.465V4.869L4.803 9 7.5 10.798zM4.803 15L11 19.131v-3.596l-3.5-2.333L4.803 15zM4 13.131L5.697 12 4 10.869v2.262zM2 9a1 1 0 0 1 .445-.832l9-6a1 1 0 0 1 1.11 0l9 6A1 1 0 0 1 22 9v6a1 1 0 0 1-.445.832l-9 6a1 1 0 0 1-1.11 0l-9-6A1 1 0 0 1 2 15V9z"/></symbol><symbol id="close-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></symbol><symbol id="menu-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/></symbol></defs></svg></head><body class="light" data-theme="light"><div class="sidebar-container"><div class="sidebar" id="sidebar"><a href="/" class="sidebar-title sidebar-title-anchor">Home</a><div class="sidebar-items-container"><div class="sidebar-section-title with-arrow" data-isopen="false" id="zskET3XeQOl_XXh7XKsiD"><div>Modules</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-eidb.html">eidb</a></div><div class="sidebar-section-children"><a href="module-eidb_base.html">eidb/base</a></div><div class="sidebar-section-children"><a href="module-eidb_idb.html">eidb/idb</a></div><div class="sidebar-section-children"><a href="module-eidb_idb_cursor.html">eidb/idb/cursor</a></div><div class="sidebar-section-children"><a href="module-eidb_idb_cursor_with_value.html">eidb/idb/cursor_with_value</a></div><div class="sidebar-section-children"><a href="module-eidb_idb_database.html">eidb/idb/database</a></div><div class="sidebar-section-children"><a href="module-eidb_idb_factory.html">eidb/idb/factory</a></div><div class="sidebar-section-children"><a href="module-eidb_idb_index.html">eidb/idb/index</a></div><div class="sidebar-section-children"><a href="module-eidb_idb_key_range.html">eidb/idb/key_range</a></div><div class="sidebar-section-children"><a href="module-eidb_idb_object_store.html">eidb/idb/object_store</a></div><div class="sidebar-section-children"><a href="module-eidb_idb_open_db_request.html">eidb/idb/open_db_request</a></div><div class="sidebar-section-children"><a href="module-eidb_idb_request.html">eidb/idb/request</a></div><div class="sidebar-section-children"><a href="module-eidb_idb_transaction.html">eidb/idb/transaction</a></div><div class="sidebar-section-children"><a href="module-eidb_idb_version_change_event.html">eidb/idb/version_change_event</a></div><div class="sidebar-section-children"><a href="module-eidb_idbx.html">eidb/idbx</a></div><div class="sidebar-section-children"><a href="module-eidb_idbx_crud.html">eidb/idbx/crud</a></div><div class="sidebar-section-children"><a href="module-eidb_idbx_fts.html">eidb/idbx/fts</a></div><div class="sidebar-section-children"><a href="module-eidb_idbx_miscs.html">eidb/idbx/miscs</a></div><div class="sidebar-section-children"><a href="module-eidb_idbx_op_hist.html">eidb/idbx/op_hist</a></div><div class="sidebar-section-children"><a href="module-eidb_idbxs.html">eidb/idbxs</a></div><div class="sidebar-section-children"><a href="module-eidb_idbxs_blind_index.html">eidb/idbxs/blind_index</a></div><div class="sidebar-section-children"><a href="module-eidb_idbxs_cruds.html">eidb/idbxs/cruds</a></div><div class="sidebar-section-children"><a href="module-eidb_idbxs_dobi.html">eidb/idbxs/dobi</a></div><div class="sidebar-section-children"><a href="module-eidb_idbxs_ftss.html">eidb/idbxs/ftss</a></div><div class="sidebar-section-children"><a href="module-eidb_idbxs_op_hists.html">eidb/idbxs/op_hists</a></div><div class="sidebar-section-children"><a href="module-eidb_net_sync.html">eidb/net/sync</a></div><div class="sidebar-section-children"><a href="module-eidb_net_wsocket.html">eidb/net/wsocket</a></div><div class="sidebar-section-children"><a href="module-eidb_storage_slocal.html">eidb/storage/slocal</a></div><div class="sidebar-section-children"><a href="module-eidb_storage_ssession.html">eidb/storage/ssession</a></div><div class="sidebar-section-children"><a href="module-eidb_utils.html">eidb/utils</a></div><div class="sidebar-section-children"><a href="module-eidb_wcrypto.html">eidb/wcrypto</a></div></div></div></div></div><div class="navbar-container" id="VuAckcnZhf"><nav class="navbar"><div class="navbar-left-items"><div class="navbar-item"><a id="" href="index.html" target="_self">Doc Home</a></div><div class="navbar-item"><a id="" href="https://github.com/desiic/enindex" target="_blank">Project Website</a></div></div><div class="navbar-right-items"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#dark-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div><nav></nav></nav></div><div class="toc-container"><div class="toc-content"><span class="bold">On this page</span><div id="eed4d2a0bfd64539bb9df78095dec881"></div></div></div><div class="body-wrapper"><div class="main-content"><div class="main-wrapper"><section id="source-page" class="source-page"><header><h1 id="title" class="has-anchor">eidb_wcrypto.js</h1></header><article><pre class="prettyprint source lang-js"><code>/**
 * @module eidb/wcrypto
 */ 

// Modules
import base     from "./base.js";
import * as ecc from "./ecc.js";

// Shorthands
var log      = console.log;
var logw     = console.warn;
var loge     = console.error;
var new_lock = base.new_lock;

// Constants
const BIT_LEN = 256;

// Fixed IV for searching with index feature.
// WARN: THESE FIXED IV VALUES SHOULD STAY UNCHANGED.
//       0->15 is teddious, stepping 2 is even (maybe easy?), using stepping 3:
const FIXED_IV_BYTES = new Uint8Array([0,3,6,9, 12,15,18,21, 24,27,30,33, 36,39,42,45]); 
const FIXED_IV       = "000306090c0f1215181b1e2124272a2d";

/**
 * Crypto class&lt;br/>
 * NOTE: Web Crypto always return ArrayBuffer but receive Uint8Array params.
 *       ALL ARE DEFAULTED TO 256-BIT IN THIS MODULE (EXCEPT RSA).
 */
class wcrypto {
    static BIT_LEN        = BIT_LEN;
    static FIXED_IV_BYTES = FIXED_IV_BYTES;
    static FIXED_IV       = FIXED_IV;

    /**
     * _________________________________________________________________________
     */
    static EXTERNAL_LIBS(){}

    /**
     * Make ECDSA public key from private key
     * NOTE:  THIS IS USING Elliptic LIB, NOT WEB CRYPTO.&lt;br/>
     * TO-DO: USE DIRECT BigInt CALCULATION SIMILAR TO ecc.js TO AVOID THE DEPENDENCY Elliptic.
     * @param  {String} Priv_Hex - Private key (number d) 
     * @return {Array}  Public key point (2 numbers x,y)
     */ 
    static async get_pubkey_point(Priv_Hex){
        // Elliptic is not ES6 lib, loaded in separate script tag, 
        // but EnIndex is async load, make sure Elliptic is loaded before calling
        var [Lock,unlock] = new_lock();

        setTimeout(()=>{
            if (window.elliptic == null)
                loge("wcrypto.get_pubkey_point: No Elliptic lib found.");
        },30*1000);

        setTimeout(function wait4ellipic(){
            if (window.elliptic == null){
                setTimeout(wait4ellipic,0);
                return;
            }

            // Create curve
            var Curve = elliptic.ec("p256");
            // Get private key
            var Privkey = Curve.keyFromPrivate(Priv_Hex);
            // Get public key
            var Pubkey = Privkey.getPublic();

            // Return EC public key as 2 numbers
            // WARN: Not Pubkey.x, .y, they are different values compared to getX(), getY().
            // .toString(16) is built-in to get hex.
            var Xhex = Pubkey.getX().toString(16);
            var Yhex = Pubkey.getY().toString(16);
            while (Xhex.length&lt;64) Xhex="0"+Xhex;
            while (Yhex.length&lt;64) Yhex="0"+Yhex;

            unlock([Xhex, Yhex]);
        },0);
        return await Lock;
    }

    /**
     * _________________________________________________________________________
     */
    static BASE_FUNCS(){}

    /**
     * Random values (unsigned)
     */ 
    static get_random_values_unsigned(bits,count){ // 8, 16, 32, 64
        if (bits!=8 &amp;&amp; bits!=16 &amp;&amp; bits!=32 &amp;&amp; bits!=64){
            loge("wcrypto.get_random_values_unsigned: Bits must be 8, 16, 32, or 64");
            return;
        }

        if (bits==8)  var Arr=new Uint8Array(count);
        if (bits==16) var Arr=new Uint16Array(count);
        if (bits==32) var Arr=new Uint32Array(count);
        if (bits==64) var Arr=new BigUint64Array(count);

        window.crypto.getRandomValues(Arr);
        return Arr;
    }

    /**
     * Random values (signed)
     */ 
    static get_random_values_signed(bits,count){ // 8, 16, 32, 64
        if (bits!=8 &amp;&amp; bits!=16 &amp;&amp; bits!=32 &amp;&amp; bits!=64){
            loge("wcrypto.get_random_values_signed: Bits must be 8, 16, 32, or 64");
            return;
        }

        if (bits==8)  var Arr=new Int8Array(count);
        if (bits==16) var Arr=new Int16Array(count);
        if (bits==32) var Arr=new Int32Array(count);
        if (bits==64) var Arr=new BigInt64Array(count);

        window.crypto.getRandomValues(Arr);
        return Arr;
    }

    /**
     * Random 16-byte IV
     */ 
    static random_iv(){
        // 16 bytes
        return wcrypto.get_random_values_unsigned(8, 16);
    }

    /**
     * Random UUID
     */
    static random_uuid(){
        return window.crypto.randomUUID();
    }

    /**
     * Random UUID extended (256 bits, no dashes)
     */
    static random_uuidx(){
        var Left  = window.crypto.randomUUID();
        var Right = window.crypto.randomUUID();
        return (Left+Right).replaceAll("-","");
    }

    /**
     * _________________________________________________________________________
     */
    static UTILS(){}

    /**
     * Base64URL to Base64
     */
    static base64url_to_base64(Str){
        return Str.replaceAll("-","+").replaceAll("_","/");
    }

    /**
     * Base64 to Base64URL
     */
    static base64_to_base64url(Str){
        return Str.replaceAll("+","-").replaceAll("/","_").replaceAll("=","");
    }

    /**
     * UTF8 to bytes (Uint8Array)
     */ 
    static utf8_to_bytes(Text){
        return new TextEncoder().encode(Text);
    }

    /**
     * Bytes (Uint8Array) to UTF8
     */ 
    static bytes_to_utf8(Bytes){
        return new TextDecoder("utf-8").decode(Bytes);
    }

    /**
     * ArrayBuffer to Uint8Array (bytes)
     */
    static buff_to_bytes(Buffer){
        return new Uint8Array(Buffer);
    }

    /**
     * Uint8Array (bytes) to ArrayBuffer&lt;br/>
     * WARN: SOME SIZE PROBLEM ACCESSING .buffer 
     */ 
    static bytes_to_buff(Bytes){
        return Bytes.buffer;
    }

    /**
     * ArrayBuffer to hex, ref: https://stackoverflow.com/a/40031979/5581893
     */
    static buff_to_hex(Buffer) {
        return [...new Uint8Array(Buffer)].
            map(v => v.toString(16).padStart(2,"0")).
            join("");
    }

    /**
     * Hex to buff&lt;br/>
     * WARN: SOME SIZE PROBLEM ACCESSING .buffer 
     */ 
    static hex_to_buff(Hex){
        return wcrypto.hex_to_bytes(Hex).buffer;
    }

    /**
     * Uint8Array to hex, ref: https://stackoverflow.com/a/40031979/5581893
     * Another option: https://stackoverflow.com/a/34356351/5581893
     */
    static bytes_to_hex(Bytes) {
        return [...Bytes].
            map(v => v.toString(16).padStart(2,"0")).
            join("");
    }

    /**
     * Hex to bytes
     */ 
    static hex_to_bytes(Hex){
        var Bytes = new Uint8Array(Hex.length/2);

        for (let i=0; i&lt;Bytes.byteLength; i++)
            Bytes[i] = parseInt(Hex.substring(i*2, i*2+2), 16);

        return Bytes;
    }

    /**
     * ArrayBuffer to base64, ref: https://stackoverflow.com/a/9458996/5581893
     */
    static buff_to_base64(Buffer){        
        var Bytes     = new Uint8Array(Buffer);
        var len       = Bytes.byteLength;
        var Bytes_Str = ""; // Bytes in form of string

        for (var i=0; i&lt;len; i++) 
            Bytes_Str += String.fromCharCode(Bytes[i]);

        return window.btoa(Bytes_Str); // Bytes string to ASCII base64
    }

    /**
     * Base64 to buffer&lt;br/>
     * WARN: SOME SIZE PROBLEM ACCESSING .buffer 
     */
     static base64_to_buff(Base64){
        var Bytes_Str = window.atob(Base64); // ASCII base64 to bytes string
        var Bytes     = new Uint8Array(Bytes_Str.length);
        
        for (let i=0; i&lt;Bytes.byteLength; i++)
            Bytes[i] = Bytes_Str.charCodeAt(i);

        return Bytes.buffer;
    }

    /**
     * Uint8Array to base64
     */
    static bytes_to_base64(Bytes){
        var len       = Bytes.byteLength;
        var Bytes_Str = ""; // Bytes in form of string

        for (let i=0; i&lt;len; i++) 
            Bytes_Str += String.fromCharCode(Bytes[i]);

        return window.btoa(Bytes_Str); // Bytes string to ASCII base64
    }    

    /**
     * Base64 to bytes
     */
    static base64_to_bytes(Base64){
        var Bytes_Str = window.atob(Base64); // ASCII base64 to bytes string
        var Bytes     = new Uint8Array(Bytes_Str.length);
        
        for (let i=0; i&lt;Bytes.byteLength; i++)
            Bytes[i] = Bytes_Str.charCodeAt(i);

        return Bytes;
    }

    /**
     * Base64 to hex
     */
    static base64_to_hex(Base64){
        return wcrypto.bytes_to_hex(wcrypto.base64_to_bytes(Base64));
    }

    /**
     * Hex to base64
     */ 
    static hex_to_base64(Hex){
        return wcrypto.bytes_to_base64(wcrypto.hex_to_bytes(Hex));
    }

    /**
     * Base64URL to hex
     */
    static base64url_to_hex(Base64){
        Base64 = wcrypto.base64url_to_base64(Base64);
        return wcrypto.bytes_to_hex(wcrypto.base64_to_bytes(Base64));
    }

    /**
     * Hex to base64URL
     */ 
    static hex_to_base64url(Hex){
        var Base64 = wcrypto.bytes_to_base64(wcrypto.hex_to_bytes(Hex));
        return wcrypto.base64_to_base64url(Base64);
    }

    /**
     * _________________________________________________________________________
     */
    static SUBTLE(){}

    /**
     * Digest to SHA1
     */
    static async digest_sha1(Text){
        var Bytes = wcrypto.utf8_to_bytes(Text);
        var Buff  = await window.crypto.subtle.digest("SHA-1",Bytes);
        return this.buff_to_hex(Buff);
    } 

    /**
     * Digest to SHA256
     */
    static async digest_sha256(Text){
        var Bytes = wcrypto.utf8_to_bytes(Text);
        var Buff  = await window.crypto.subtle.digest("SHA-256",Bytes);
        return this.buff_to_hex(Buff);
    }

    /**
     * Generate key&lt;br/>
     * AES only, options are AES-CBC (block), AES-CTR (counter), AES-GCM (enhanced counter);
     * AES-GCM is better, used in TLS 1.2 https://stackoverflow.com/a/22958889/5581893
     */ 
    static async generate_key_aes(){
        var Aes_Gcm = {name:"AES-GCM", length:BIT_LEN};
        var Algorithm,extractable;
        var Usages = ["encrypt","decrypt"]; 
                      // "sign","verify","deriveBits","deriveKey","wrapKey","unwrapKey"

        return await window.crypto.subtle.generateKey(
            Algorithm   = Aes_Gcm,
            extractable = true,
            Usages
        );
    }

    /**
     * Generate key AES-KW (key wrapping)
     */ 
    static async generate_key_aes_kw(){
        var Aes_Gcm = {name:"AES-KW", length:BIT_LEN};
        var Algorithm,extractable;
        var Usages = ["wrapKey","unwrapKey"]; 
                      // "encrypt","decrypt","sign","verify","deriveBits","deriveKey"

        return await window.crypto.subtle.generateKey(
            Algorithm   = Aes_Gcm,
            extractable = true,
            Usages
        );
    }

    /**
     * Generate key RSA for encryption/decryption&lt;br/>
     * RSA algos: RSASSA-PKCS1-v1_5 (first), RSA-OAEP, RSA-PSS (latest)
     * Ref: https://medium.com/asecuritysite-when-bob-met-alice/so-what-are-rsa-pcks-1-5-rsa-oaep-and-rsa-pss-and-why-is-it-important-to-pick-the-right-one-e639992fba09
     */ 
    static async generate_keys_rsa_ed(){ // ed: Encrypt/Decrypt
        // Modulus length: OpenSSL, GitHub, Mozilla: https://expeditedsecurity.com/blog/measuring-ssl-rsa-keys
        // Pub exponent: // https://developer.mozilla.org/en-US/docs/Web/API/RsaHashedKeyGenParams
        var Algo = {
            name:           "RSA-OAEP",
            modulusLength:  2048, 
            publicExponent: new Uint8Array([0x01, 0x00, 0x01]), 
            hash:           "SHA-256"
        };
        var extractable;
        /*
        Web Crypto API features availability:
        https://diafygi.github.io/webcrypto-examples/
        ===================================================================
                            Encrypt+Decrypt   Sign+Verify   Enc+Dec+Sig+Ver
        RSASSA-PKCS1-v1_5          -             Yes               -
        RSA-OAEP                  Yes             -                -
        RSA-PSS                    -             Yes               -
        ===================================================================
        */
        var Usages = ["encrypt","decrypt"];
                      // "sign","verify","deriveBits","deriveKey","wrapKey","unwrapKey"

        return await window.crypto.subtle.generateKey(
                     Algo, extractable=true, Usages);
    }

    /**
     * Generate key RSA for sign/verify&lt;br/>
     * RSA algos: RSASSA-PKCS1-v1_5 (first), RSA-OAEP, RSA-PSS (latest)
     * Ref: https://medium.com/asecuritysite-when-bob-met-alice/so-what-are-rsa-pcks-1-5-rsa-oaep-and-rsa-pss-and-why-is-it-important-to-pick-the-right-one-e639992fba09
     */ 
    static async generate_keys_rsa_sv(){ // sv: Sign/Verify
        // Modulus length: OpenSSL, GitHub, Mozilla: https://expeditedsecurity.com/blog/measuring-ssl-rsa-keys
        // Pub exponent: // https://developer.mozilla.org/en-US/docs/Web/API/RsaHashedKeyGenParams
        var Algo = {
            name:           "RSA-PSS",
            modulusLength:  2048,
            publicExponent: new Uint8Array([0x01, 0x00, 0x01]),
            hash:           "SHA-256"
        };
        var extractable;
        /*
        Web Crypto API features availability:
        https://diafygi.github.io/webcrypto-examples/
        ===================================================================
                            Encrypt+Decrypt   Sign+Verify   Enc+Dec+Sig+Ver
        RSASSA-PKCS1-v1_5          -             Yes               -
        RSA-OAEP                  Yes             -                -
        RSA-PSS                    -             Yes               -
        ===================================================================
        */
        var Usages = ["sign","verify"]; 
                      // "encrypt","decrypt","deriveBits","deriveKey","wrapKey","unwrapKey"

        return await window.crypto.subtle.generateKey(
                     Algo, extractable=true, Usages);
    }

    /**
     * Generate key EC (elliptic curve) for encryption/decryption&lt;br/>
     * Web Crypto ECDSA can only sign, Web Crypto ECDH can't en/decrypt or sign/verify&lt;br/>
     * A solution is at this reference:
     * https://jameshfisher.com/2017/11/03/web-cryptography-api-asymmetric-encryption-example/
     * NOTE: NOT IMPLEMENTED, SENDER MAY LEAK HIS/HER OWN PRIVATE KEY AND THE MESSAGE 
     *       IS NO LONGER ONLY-RECEIVER-CAN-READ.
     */ 
    static async generate_keys_ec_ed(){ // ed: Encryption/Decryption
        /*
        // 2 EC (ECDH) key pairs:
        const aliceKeyPair = await genKeyPair();
        const bobKeyPair   = await genKeyPair();
        // The same AES key:
        const aliceSecret  = await deriveKey(aliceKeyPair.privateKey, bobKeyPair.publicKey  );
        const bobSecret    = await deriveKey(  bobKeyPair.privateKey, aliceKeyPair.publicKey);
        // JSON web key:
        console.log((await exportKey(aliceSecret)).k === (await exportKey(bobSecret)).k);
        */
    }

    /**
     * Generate key EC (elliptic curve, ECDSA) for sign/verify
     */
    static async generate_keys_ec_sv(){ // sv: Sign/Verify
        var Algo = {
            name:       "ECDSA",
            namedCurve: "P-256" // 256 is common
        };
        var extractable;
        var Usages = ["sign","verify"]; 
                      // "encrypt","decrypt","deriveBits","deriveKey","wrapKey","unwrapKey"

        return await window.crypto.subtle.generateKey(
                     Algo, extractable=true, Usages);
    }

    /**
     * Import key from password for derivation
     */ 
    static async import_key_pb_raw(Password){
        var extractable;
        var Bytes  = wcrypto.utf8_to_bytes(Password);
        var Usages = ["deriveBits","deriveKey"];  
                      // "encrypt","decrypt","sign","verify","wrapKey","unwrapKey"

        try{                      
            // PBKDF2 keys must set extractable=false                      
            var Key = await window.crypto.subtle.
                      importKey("raw",Bytes,{name:"PBKDF2"},extractable=false,Usages);
        }
        catch(Err){
            loge("wcrypto.import_key_pb_raw: Failed to import, error:",Err);
            return null;
        }
        return Key;
    }

    /**
     * Import AES (GCM) key for en/decryption
     */ 
    static async import_key_aes_raw(Hex){
        if (Hex.length != BIT_LEN/8 * 2) { // AES 256-bit
            loge("wcrypto.import_key_raw: Hex of key must be of length 64 chars");
            return null;
        }

        var extractable;
        var Bytes  = wcrypto.hex_to_bytes(Hex);
        var Usages = ["encrypt","decrypt"]; 
                      // "sign","verify","deriveBits","deriveKey","wrapKey","unwrapKey"
        
        try{        
            var Key = await window.crypto.subtle.
                      importKey("raw",Bytes,{name:"AES-GCM"},extractable=true,Usages);
        }
        catch(Err){
            loge("wcrypto.import_key_aes_raw: Failed to import, error:",Err);
            return null;
        }
        return Key;
    }

    /**
     * Import RSA key from JWK for sign/verify&lt;br/>
     * Rsa_Algo: https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/importKey
     */
    static async import_key_rsa_jwk(Jwk_Obj, Rsa_Algo="RSA-PSS"){ // Rsa_Algo: String        
        var Algo = {name:Rsa_Algo, hash:"SHA-256"};
        
        if (Rsa_Algo=="RSA-OAEP")
            var Usages = ["encrypt","decrypt"];
        else
            var Usages = ["sign","verify"];

        try{
            var extractable;
            return await window.crypto.subtle.importKey("jwk",Jwk_Obj,Algo,
                         extractable=true,Usages);
        }
        catch(Err){
            loge("wcrypto.import_key_rsa_jwk: Failed to import, error:",Err);
            return null;
        }
    }

    /**
     * Import EC key from JWK for sign/verify&lt;br/>
     * Ec_Algo: https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/importKey
     */ 
    static async import_key_ec_jwk(Jwk_Obj, Ec_Algo="ECDSA"){ // Ec_Algo: String
        var Algo = {name:Ec_Algo, namedCurve:"P-256"};

        if (Jwk_Obj.d != null)
            var Usages = ["sign"]; // Private key
        else
            var Usages = ["verify"]; // Public key

        try{
            var extractable;
            return await window.crypto.subtle.importKey("jwk",Jwk_Obj,Algo,
                         extractable=true,Usages);
        }
        catch(Err){
            loge("wcrypto.import_key_ec_jwk: Failed to import, error:",Err);
            return null;
        }
    }

    /**
     * Export AES key to hex
     */
    static async export_key_hex(Key){
        return wcrypto.buff_to_hex(await window.crypto.subtle.exportKey("raw",Key));
    }

    /**
     * Export RSA|EC key to JWK
     */
    static async export_key_jwk(Key){
        try{
            var Obj = await window.crypto.subtle.exportKey("jwk",Key);
            return Obj;
        }
        catch(Err){
            loge("wcrypto.export_key_jwk: Failed to export, error:",Err);
            return null;
        }
    }

    /**
     * Derive bits from password
     */
    static async derive_bits_pb(Password,Salt,iterations, bit_count=BIT_LEN){
        var Base_Key = await wcrypto.import_key_pb_raw(Password);        

        // Create key from base key (which contains password)
        var Algo = {
            name:       "PBKDF2",  // Base key is
            hash:       "SHA-256", // Base key is
            salt:       wcrypto.utf8_to_bytes(Salt),
            iterations: iterations
        }; 

        try{
            var Bits = await window.crypto.subtle.deriveBits(Algo,Base_Key,bit_count);
            return wcrypto.buff_to_hex(Bits);
        }
        catch(Err){
            loge("wcrypto.derive_bits_pb: Failed to derive, error:",Err);
            return null;
        }
    }

    /**
     * Derive AES key from password (password-based) for en/decrypt&lt;br/>
     * Ref: https://github.com/infotechinc/password-based-key-derivation-in-browser/blob/master/pbkdf2.js
     */
    static async derive_key_pb2aes(Password,Salt,iterations){
        var Base_Key = await wcrypto.import_key_pb_raw(Password);        

        // Create key from base key (which contains password)
        var Algo = {
            name:       "PBKDF2", // Password-based key derivation format 2 
            hash:       "SHA-256",
            salt:       wcrypto.utf8_to_bytes(Salt),
            iterations: iterations
        }; 
        var extractable;
        var Usages = ["encrypt","decrypt"]; 
                      // "sign","verify","deriveBits","deriveKey","wrapKey","unwrapKey"

        try{
            var Key = await window.crypto.subtle.deriveKey(Algo,Base_Key,
                        {name:"AES-GCM",length:BIT_LEN},extractable=true,Usages);
            return Key;
        }
        catch(Err){
            loge("wcrypto.derive_key_pb2aes: Failed to derive, error:",Err);
            return null;
        }
    }

    /**
     * Derive RSA key pair from password, for en/decrypt | sign/verify&lt;br/>
     * OPTION:&lt;br/>
     * - When Web Crypto support deriving to asymmetric keys, only symmetric now.
     * - Or when Web Crypto support custom randfunc for using when generating key
     * - Or use a reliable library to derive (RSA -> JWK -> alter (lib) -> import)
     */ 
    static async derive_keys_pb2rsa(Password,Salt,iterations){
        // TO-DO: NOT URGENT.
    }

    /**
     * Derive EC key pair from password, for sign/verify&lt;br/>
     * WARN:&lt;br/>
     * THIS IS A WORK-AROUND METHOD TO DERIVE EC KEYS FROM PASSWORD
     * COZ WEB CRYPTO API ONLY DERIVE TO HMAC OR AES. IT'S POSSIBLE TO PROVIDE
     * RANDFUNC TO RSA OR EC GENERATOR TO DERIVE BUT SUCH FEATURE ISN'T IN WEB CRYPTO YET.
     * 
     * Elliptic curve: y² = x³ + ax + b
     * Theory:         https://cryptobook.nakov.com/asymmetric-key-ciphers/elliptic-curve-cryptography-ecc
     * Maths:          https://en.wikipedia.org/wiki/Modular_arithmetic
     * P-256 curve:    https://neuromancer.sk/std/nist/P-256
     * 
     * Maths:
     * ```
     * y² = x³ + ax + b (mod p)  &lt;=>  y² - (x³ + ax + b) = tp
     * ```
     * 
     * Procedure:&lt;br/>
     * ECSA -> JWK -> alter -> import&lt;br/>
     * Pubkey = Privkey * G, Note: This is Elliptic Curve scalar multiplication,
     * see: https://en.wikipedia.org/wiki/Elliptic_curve_point_multiplication#Point_multiplication
     * 
     * EC maths (secp256k1) in pure JavaScript:&lt;br/>
     * https://paulmillr.com/posts/noble-secp256k1-fast-ecc/
     * 
     * Notation:&lt;br/>
     * d:   Decryption key (private key)
     * x,y: Encryption key (public key)
     */
    static async derive_keys_pb2ec(Password,Salt,iterations){
        // Constants from the P-256 link in doc block above, key size: 256 bits
        var p =  BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"); // Prime
        var a =  BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"); // Param
        var b =  BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"); // Param
        var G = [BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"), // Base point
                 BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")];
        var n =  BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"); // Curve order (max d+1)
        var h =  BigInt("0x01"); // Cofactor        

        // Bitcoin curve (secp256k1, aka K256) not working with P-256,
        // keep the constants above to work with code in file ecc.js
        // after altering it to work with P-256. 2 code lines right below here
        // are commented out.
        /*
        ecc.set_curve(p,n,G[0],G[1]);
        var Pubkey = await ecc.get_pubkey_point(G, d);  
        */

        // (1) Get random ECDSA keypair ==========
        // Generate EC key pair by Web Crypto to be compatible with Web Crypto 
        // for sign and verify only
        var Keypair = await wcrypto.generate_keys_ec_sv();

        // Convert to JWK to alter
        var Jwk_Priv = await wcrypto.export_key_jwk(Keypair.privateKey);
        var Jwk_Pub  = await wcrypto.export_key_jwk(Keypair.publicKey);

        // (2) Derive private &amp; public key ==========
        // Hash to get EC private key d (decryption key)
        var d = Password+Salt;

        for (let i=0; i&lt;iterations; i++)
            d = await wcrypto.digest_sha256(d);

        // Use lib to make public key, point(x,y)
        var [x,y] = await wcrypto.get_pubkey_point(d);

        // (3) Put private &amp; public key into JWKs ==========
        // Convert d, x, y to base64url format to put back to JWK object
        d = wcrypto.hex_to_base64url(d);
        x = wcrypto.hex_to_base64url(x);
        y = wcrypto.hex_to_base64url(y);

        Jwk_Priv.d = d; 
        Jwk_Priv.x = x;
        Jwk_Priv.y = y;
        Jwk_Pub. x = x;
        Jwk_Pub. y = y;

        // (4) Convert JWKs back to keys ==========
        var Privkey = await wcrypto.import_key_ec_jwk(Jwk_Priv,"ECDSA");
        var Pubkey  = await wcrypto.import_key_ec_jwk(Jwk_Pub, "ECDSA");

        // (5) Make derived ECDSA keypair ==========
        var Derived_Keypair = {privateKey:Privkey, publicKey:Pubkey};
        return Derived_Keypair;
    }

    /**
     * Encrypt with AES key (GCM) to base64
     */ 
    static async encrypt_aes(Text, Key, Iv_Hex=null){
        if (Iv_Hex==null)
            var Iv = wcrypto.random_iv();
        else   
            var Iv = wcrypto.hex_to_bytes(Iv_Hex);

        var Bytes = wcrypto.utf8_to_bytes(Text); // Always UTF-8 to bytes        
        var Algo  = {name:"AES-GCM", iv:Iv};
        
        try{
            var Cipherbuff = await window.crypto.subtle.encrypt(Algo,Key,Bytes); // ArrayBuffer
        }
        catch(Err){
            loge("wcrypto.encrypt_aes: Failed to encrypt, error:",Err);
            return null;
        }

        var Ciphertext = wcrypto.buff_to_base64(Cipherbuff);
        return [Ciphertext, wcrypto.bytes_to_hex(Iv)];
    }

    /**
     * Encrypt with AES key (GCM) to base64, with fixed IV, for facilitating
     * encrypted search on index for field value.
     */ 
    static async encrypt_aes_fiv(Text, Key){ // fiv: Fixed IV
        return await wcrypto.encrypt_aes(Text, Key, FIXED_IV)
    }

    /**
     * Encrypt with RSA key to base64
     */ 
    static async encrypt_rsa(Text, Key){
        var Bytes = wcrypto.utf8_to_bytes(Text); // Always UTF-8 to bytes
        var Algo  = {name:"RSA-OAEP"};

        try{
            var Cipherbuff = await window.crypto.subtle.encrypt(Algo,Key,Bytes); // ArrayBuffer
        }
        catch(Err){
            loge("wcrypto.encrypt_rsa: Failed to encrypt, error:",Err);
            return null;
        }

        var Ciphertext = wcrypto.buff_to_base64(Cipherbuff);
        return Ciphertext;
    }

    /**
     * Encrypt with EC key to base64
     */ 
    static async encrypt_ec(Text, Key){
        // NO EC ENCRYPT/DECRYPT IN WEB CRYPTO YET.
    }

    /**
     * Decrypt (AES) from base64
     */
    static async decrypt_aes(Ciphertext, Iv, Key){
        var Bytes = wcrypto.base64_to_bytes(Ciphertext);
        var Algo  = {name:"AES-GCM", iv:wcrypto.hex_to_bytes(Iv)};

        try{
            var Buff = await window.crypto.subtle.decrypt(Algo,Key,Bytes);
        }
        catch(Err){
            loge("wcrypto.decrypt_aes: Failed to decrypt, error:",Err);
            return null;
        }

        var Text = wcrypto.bytes_to_utf8(new Uint8Array(Buff));
        return Text;
    }

    /**
     * Decrypt (AES) from base64, with fixed IV, for facilitating
     * encrypted search on index for field value.
     */
    static async decrypt_aes_fiv(Ciphertext, Key){
        return await wcrypto.decrypt_aes(Ciphertext, FIXED_IV, Key);
    }

    /**
     * Decrypt (RSA) from base64
     */
    static async decrypt_rsa(Ciphertext, Key){
        var Bytes = wcrypto.base64_to_bytes(Ciphertext);
        var Algo  = {name:"RSA-OAEP"};

        try{
            var Buff = await window.crypto.subtle.decrypt(Algo,Key,Bytes);
        }
        catch(Err){
            loge("wcrypto.decrypt_rsa: Failed to decrypt, error:",Err);
            return null;
        }

        var Text = wcrypto.bytes_to_utf8(new Uint8Array(Buff));
        return Text;
    }

    /**
     * Decrypt with EC key from base64
     */ 
    static async decrypt_ec(Ciphertext, Key){
        // NO EC ENCRYPT/DECRYPT IN WEB CRYPTO YET.
    }

    /**
     * Sign and get a signature (a hash in hex) using RSA-PSS or ECDSA private key
     * @param  {String} Text    - UTF8 text
     * @param  {Object} Privkey - A private key
     * @return {String} Hash string
     */ 
    static async sign(Text, Privkey){
        if (Privkey.algorithm.name=="RSA-PSS")
            var Algo = {name:"RSA-PSS", saltLength:BIT_LEN}; // RSA defaulted to SHA-256 in this module.
        else
            var Algo = {name:"ECDSA", hash:"SHA-256"};
            
        var Bytes = wcrypto.utf8_to_bytes(Text);
        
        try{
            var Buff = await window.crypto.subtle.sign(Algo,Privkey,Bytes);
        }
        catch(Err){
            loge("wcrypto.sign: Failed to sign, error:",Err);
            return null;
        }

        return wcrypto.buff_to_hex(Buff);
    }

    /**
     * Verify cipher text (base64) using RSA-PSS or ECDSA public key
     * @param  {String}  Text      - Any text
     * @param  {String}  Signature - The signature hash obtained after signing in hex string
     * @param  {Object}  Pubkey    - A public key matching the priv key used when sign
     * @return {Boolean} true if the signature is ok, false otherwise
     */ 
    static async verify(Text, Signature, Pubkey){
        if (Pubkey.algorithm.name=="RSA-PSS")
            var Algo = {name:"RSA-PSS", saltLength:BIT_LEN}; // RSA defaulted to SHA-256 in this module.
        else
            var Algo = {name:"ECDSA", hash:"SHA-256"};

        var Text_Bytes = wcrypto.utf8_to_bytes(Text);
        var Sig_Bytes  = wcrypto.hex_to_bytes(Signature);

        try{
            return await window.crypto.subtle.verify(Algo,Pubkey,Sig_Bytes,Text_Bytes);
        }
        catch(Err){
            loge("wcrypto.verify: Failed to verify, error:",Err);
            return null;
        }
    }

    /**
     * Wrap key
     */
    static async wrap_key(){
        // TO-DO
    }

    /**
     * Unwrap key
     */ 
    static async unwrap_key(){
        // TO-DO
    }

    /**
     * _________________________________________________________________________
     */
    static EXTENDED(){} 

    /**
     * Split string into 2
     */
    static split_into_2(Str){
        var mid    = Math.floor(Str.length / 2);
        var Trunk1 = Str.substring(0,mid);
        var Trunk2 = Str.substring(mid);
        return [Trunk1,Trunk2];
    }

    /**
     * Get encryption key and auth key from password&lt;br/>
     * Encryption first, first bit trunk is more important as it's also the 
     * derived bits with half number of bits, and users encrypt data on 
     * client side first before registration with server.
     * 
     * HMAC isn't secure enough as there's an agreed secret and may leak from server side:&lt;br/>
     * https://stackoverflow.com/a/18693622/5581893
     * 
     * Options for E2EE keys: AES+RSApair, AES+ECpair&lt;br/>
     * However, Web Crypto doesn't provide derivation method to RSA or EC;
     * quite time taking to create RSA pair with pure JS especially the modules and primes;
     * EC pair will be created instead since any interger below EC:n can be key.
     * 
     * This method creates AES key + EC keys, instead of AES key + HMAC key.
     * User keeps priv key, send pub key to server for registration.&lt;br/>
     * Ref: https://stackoverflow.com/a/20484325/5581893
     * @return {Array} 1 AES-GCM 256-bit key for encryption key, 1 EC 256-bit key pair 
     *                 for authentication (upon handshake server should send some text 
     *                 for client to sign).
     */
    static async password2keys(Password,Salt,iterations){
        var Bits_Str        = await wcrypto.derive_bits_pb(Password,Salt,iterations,2*BIT_LEN);
        var [Trunk1,Trunk2] = wcrypto.split_into_2(Bits_Str); // 2 x 256 bits
        var Enc_Key         = await wcrypto.derive_key_pb2aes(Trunk1,Salt,iterations); // AES 256-bit key
        var Auth_Keys       = await wcrypto.derive_keys_pb2ec(Trunk2,Salt,iterations); // EC 256-bit keypair
        return [Enc_Key,Auth_Keys];
    }

    /**
     * Get static key (for data encryption to avoid decrypt+re-encryption when 
     * password changes); static key is encrypted by enc key by password2keys.
     * Static key should be saved encrypted in `metadata` object store.
     * @return {Object} AES-GCM 256-bit key
     */
    static async make_static_key(Salt,iterations){
        var Rand = wcrypto.random_uuidx(); // 256 bits
        return await wcrypto.derive_key_pb2aes(Rand,Salt,iterations); // AES 256-bit
    }

    /**
     * Init static stuff
     */ 
    static init(){
    }
}

export default wcrypto;
// EOF</code></pre></article></section></div></div></div><div class="search-container" id="PkfLWpAbet" style="display:none"><div class="wrapper" id="iCxFxjkHbP"><button class="icon-button search-close-button" id="VjLlGakifb" aria-label="close search"><svg><use xlink:href="#close-icon"></use></svg></button><div class="search-box-c"><svg><use xlink:href="#search-icon"></use></svg> <input type="text" id="vpcKVYIppa" class="search-input" placeholder="Search..." autofocus></div><div class="search-result-c" id="fWwVHRuDuN"><span class="search-result-c-text">Type anything to view search result</span></div></div></div><div class="mobile-menu-icon-container"><button class="icon-button" id="mobile-menu" data-isopen="false" aria-label="menu"><svg><use xlink:href="#menu-icon"></use></svg></button></div><div id="mobile-sidebar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><a href="/" class="sidebar-title sidebar-title-anchor">Home</a><div class="mobile-nav-links"><div class="navbar-item"><a id="" href="index.html" target="_self">Doc Home</a></div><div class="navbar-item"><a id="" href="https://github.com/desiic/enindex" target="_blank">Project Website</a></div></div><div class="mobile-sidebar-items-c"><div class="sidebar-section-title with-arrow" data-isopen="false" id="zskET3XeQOl_XXh7XKsiD"><div>Modules</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-eidb.html">eidb</a></div><div class="sidebar-section-children"><a href="module-eidb_base.html">eidb/base</a></div><div class="sidebar-section-children"><a href="module-eidb_idb.html">eidb/idb</a></div><div class="sidebar-section-children"><a href="module-eidb_idb_cursor.html">eidb/idb/cursor</a></div><div class="sidebar-section-children"><a href="module-eidb_idb_cursor_with_value.html">eidb/idb/cursor_with_value</a></div><div class="sidebar-section-children"><a href="module-eidb_idb_database.html">eidb/idb/database</a></div><div class="sidebar-section-children"><a href="module-eidb_idb_factory.html">eidb/idb/factory</a></div><div class="sidebar-section-children"><a href="module-eidb_idb_index.html">eidb/idb/index</a></div><div class="sidebar-section-children"><a href="module-eidb_idb_key_range.html">eidb/idb/key_range</a></div><div class="sidebar-section-children"><a href="module-eidb_idb_object_store.html">eidb/idb/object_store</a></div><div class="sidebar-section-children"><a href="module-eidb_idb_open_db_request.html">eidb/idb/open_db_request</a></div><div class="sidebar-section-children"><a href="module-eidb_idb_request.html">eidb/idb/request</a></div><div class="sidebar-section-children"><a href="module-eidb_idb_transaction.html">eidb/idb/transaction</a></div><div class="sidebar-section-children"><a href="module-eidb_idb_version_change_event.html">eidb/idb/version_change_event</a></div><div class="sidebar-section-children"><a href="module-eidb_idbx.html">eidb/idbx</a></div><div class="sidebar-section-children"><a href="module-eidb_idbx_crud.html">eidb/idbx/crud</a></div><div class="sidebar-section-children"><a href="module-eidb_idbx_fts.html">eidb/idbx/fts</a></div><div class="sidebar-section-children"><a href="module-eidb_idbx_miscs.html">eidb/idbx/miscs</a></div><div class="sidebar-section-children"><a href="module-eidb_idbx_op_hist.html">eidb/idbx/op_hist</a></div><div class="sidebar-section-children"><a href="module-eidb_idbxs.html">eidb/idbxs</a></div><div class="sidebar-section-children"><a href="module-eidb_idbxs_blind_index.html">eidb/idbxs/blind_index</a></div><div class="sidebar-section-children"><a href="module-eidb_idbxs_cruds.html">eidb/idbxs/cruds</a></div><div class="sidebar-section-children"><a href="module-eidb_idbxs_dobi.html">eidb/idbxs/dobi</a></div><div class="sidebar-section-children"><a href="module-eidb_idbxs_ftss.html">eidb/idbxs/ftss</a></div><div class="sidebar-section-children"><a href="module-eidb_idbxs_op_hists.html">eidb/idbxs/op_hists</a></div><div class="sidebar-section-children"><a href="module-eidb_net_sync.html">eidb/net/sync</a></div><div class="sidebar-section-children"><a href="module-eidb_net_wsocket.html">eidb/net/wsocket</a></div><div class="sidebar-section-children"><a href="module-eidb_storage_slocal.html">eidb/storage/slocal</a></div><div class="sidebar-section-children"><a href="module-eidb_storage_ssession.html">eidb/storage/ssession</a></div><div class="sidebar-section-children"><a href="module-eidb_utils.html">eidb/utils</a></div><div class="sidebar-section-children"><a href="module-eidb_wcrypto.html">eidb/wcrypto</a></div></div></div><div class="mobile-navbar-actions"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#dark-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div></div></div><script type="text/javascript" src="scripts/core.min.js"></script><script src="scripts/search.min.js" defer="defer"></script><script src="scripts/third-party/fuse.js" defer="defer"></script><script type="text/javascript">var tocbotInstance=tocbot.init({tocSelector:"#eed4d2a0bfd64539bb9df78095dec881",contentSelector:".main-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0,scrollContainer:".main-content",headingsOffset:130,onClick:bringLinkToView})</script></body></html>